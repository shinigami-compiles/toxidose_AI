<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Form - ToxiDose AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" sizes="32x32"
      href="{{ url_for('static', filename='img/img/toxiDose_logo.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16"
      href="{{ url_for('static', filename='img/toxidose-favicon-16.png') }}">

</head>
<body>
    <div id="background-animation"></div>
    <div id="loading-overlay" class="loading-overlay ">
        <div class="loading-dialog">
            <div class="loading-gif">
                <img src="{{ url_for('static', filename='loading.gif') }}" alt="Loading...">
            </div>
            <div class="loading-message">Analyzing toxicity risk‚Ä¶</div>
        </div>
    </div>
    <nav>
        <div class="logo">
            <img 
                src="{{ url_for('static', filename='toxiDose_logo.png') }}" 
                alt="ToxiDose Logo" 
                class="nav-logo-img"
            >
            <span class="logo-text">ToxiDose AI</span>
        </div>
        <ul>
            <li>
                <a href="{{ url_for('landing') }}"
                   class="nav-link nav-link-tablet {% if request.endpoint == 'landing' %}active{% endif %}"
                   data-tablet-img="{{ url_for('static', filename='img/tablet-nav.png') }}">
                    Home
                </a>
            </li>
            <li>
                <a href="{{ url_for('how_it_works') }}"
                   class="nav-link nav-link-tablet {% if request.endpoint == 'how_it_works' %}active{% endif %}"
                   data-tablet-img="{{ url_for('static', filename='img/tablet-nav.png') }}">
                    Functions
                </a>
            </li>
            <li>
                <a href="{{ url_for('help_page') }}"
                   class="nav-link nav-link-tablet {% if request.endpoint == 'help_page' %}active{% endif %}"
                   data-tablet-img="{{ url_for('static', filename='img/tablet-nav.png') }}">
                    Help
                </a>
            </li>
        </ul>

    </nav>

    <div class="content-wrapper">
        <div class="form-container">
            <div class="form-header">
                <h1 class="form-title">Patient Risk Assessment</h1>
                <p class="form-subtitle">Complete the form below to analyze medication safety</p>
            </div>

            <div class="tab-header">
                <button class="tab-btn active" onclick="openTab(event, 'manual')">
                    <span class="tab-icon">üìù</span>
                    <span>Manual Entry</span>
                </button>
                <button class="tab-btn" onclick="openTab(event, 'csv')">
                    <span class="tab-icon">üìÇ</span>
                    <span>CSV Upload</span>
                </button>
            </div>

            <!-- Manual Entry Tab -->
            <div id="manual" class="tab-content active">
                <form action="/predict_manual" method="POST" class="assessment-form">
                    
                    <!-- Patient Profile Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <span class="section-icon">üë§</span>
                            <h3>Patient Profile</h3>
                        </div>
                        
                        <div class="input-grid three-col">
                            <div class="input-group">
                                <label for="age">
                                    <span class="label-icon">üéÇ</span>
                                    Age (Years)
                                </label>
                                <input type="number" id="age" name="age" required 
                                       placeholder="e.g., 45" min="1" max="120">
                            </div>
                            
                            <div class="input-group">
                                <label for="weight">
                                    <span class="label-icon">‚öñÔ∏è</span>
                                    Weight (kg)
                                </label>
                                <input type="number" id="weight" name="weight" step="0.1" required 
                                       placeholder="e.g., 70.5" min="2">
                            </div>
                            
                            <div class="input-group">
                                <label for="sex">
                                    <span class="label-icon">üë•</span>
                                    Sex
                                </label>
                                <select id="sex" name="sex" required>
                                    <option value="" disabled selected>Select...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-group pregnancy-section">
                            <label class="checkbox-label-main">
                                <input type="checkbox" name="is_pregnant" id="is_pregnant">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-text">
                                    <span class="label-icon">ü§∞</span>
                                    Currently Pregnant
                                </span>
                            </label>
                        </div>

                        <div class="input-group">
                            <label class="conditions-label">
                                <span class="label-icon">üè•</span>
                                Existing Medical Conditions
                                <span class="optional-text">(Tick all that are applicable)</span>
                            </label>
                            <div class="conditions-grid">
                                <label class="condition-card">
                                    <input type="checkbox" name="liver_disease">
                                    <span class="condition-content">
                                        <span class="condition-icon"></span>
                                        <span class="condition-name">Liver Disease</span>
                                    </span>
                                </label>
                                
                                <label class="condition-card">
                                    <input type="checkbox" name="kidney_disease">
                                    <span class="condition-content">
                                        <span class="condition-icon"></span>
                                        <span class="condition-name">Kidney Disease</span>
                                    </span>
                                </label>
                                
                                <label class="condition-card">
                                    <input type="checkbox" name="heart_disease">
                                    <span class="condition-content">
                                        <span class="condition-icon">‚ù§Ô∏è</span>
                                        <span class="condition-name">Heart Disease</span>
                                    </span>
                                </label>
                                
                                <label class="condition-card">
                                    <input type="checkbox" name="gi_issue">
                                    <span class="condition-content">
                                        <span class="condition-icon"></span>
                                        <span class="condition-name">Ulcer/Gastritis</span>
                                    </span>
                                </label>
                                
                                <label class="condition-card">
                                    <input type="checkbox" name="asthma">
                                    <span class="condition-content">
                                        <span class="condition-icon"></span>
                                        <span class="condition-name">Asthma/COPD</span>
                                    </span>
                                </label>
                                
                                <label class="condition-card">
                                    <input type="checkbox" name="diabetes">
                                    <span class="condition-content">
                                        <span class="condition-icon"></span>
                                        <span class="condition-name">Diabetes</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Regimen Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <span class="section-icon">üíä</span>
                            <h3>Current Medication Regimen</h3>
                        </div>
                        <p class="section-description">
                            Add all medicines you're currently taking. Be as accurate as possible with dosages and timing.
                        </p>

                        <div class="medicines-container">
                            <div class="medicine-card" id="medicine-template">
                                <div class="medicine-header">
                                    <span class="medicine-number">Medicine #<span class="med-num">1</span></span>
                                    <button type="button" class="remove-btn" onclick="removeMedicine(this)">
                                        <span>‚úï</span>
                                    </button>
                                </div>
                                
                                <div class="medicine-inputs">
                                    <div class="input-group full-width">
                                        <label>
                                            <span class="label-icon">üîç</span>
                                            Medicine Name
                                        </label>
                                        <input list="drugs" name="drug_name[]" 
                                               placeholder="Start typing medicine name..." required>
                                        <datalist id="drugs">
                                            {% for drug in drug_names %}
                                            <option value="{{ drug }}">
                                            {% endfor %}
                                        </datalist>
                                    </div>

                                    <div class="input-grid two-col">
                                        <div class="input-group">
                                            <label>
                                                <span class="label-icon">üíä</span>
                                                Strength per Unit
                                            </label>
                                            <div class="input-with-unit">
                                                <input type="number" name="dose[]" step="0.1" 
                                                       placeholder="500" required>
                                                <span class="unit-label">mg</span>
                                            </div>
                                        </div>

                                        <div class="input-group">
                                            <label>
                                                <span class="label-icon">üì¶</span>
                                                Units per Dose
                                            </label>
                                            <input type="number" name="units[]" value="1" min="1" 
                                                   placeholder="1" required>
                                            <span class="help-text">e.g., 1 or 2 tablets</span>
                                        </div>
                                    </div>

                                    <div class="input-grid three-col">
                                        <div class="input-group">
                                            <label>
                                                <span class="label-icon">üîÑ</span>
                                                Times per Day
                                            </label>
                                            <input type="number" name="freq[]" value="2" min="1" 
                                                   placeholder="2" required>
                                        </div>

                                        <div class="input-group">
                                            <label>
                                                <span class="label-icon">üìÖ</span>
                                                Days Taken
                                            </label>
                                            <input type="number" name="days[]" value="1" min="1" 
                                                   placeholder="5" required>
                                        </div>

                                        <div class="input-group">
                                            <label>
                                                <span class="label-icon">‚è∞</span>
                                                Hours Since Last
                                            </label>
                                            <input type="number" name="hours[]" value="4" step="0.1" 
                                                   placeholder="4" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="button" class="add-medicine-btn" onclick="addMedicine()">
                            <span class="btn-icon">‚ûï</span>
                            <span>Add Another Medicine</span>
                        </button>
                    </div>

                    <div class="form-actions">
                        <!-- Wrapper so we can position the gif relative to the button -->
                        <div class="submit-with-injection">
                            <button type="submit" class="submit-btn">
                                <span class="btn-icon"></span>
                                <span>Analyse Risk</span>
                            </button>

                            <!-- Injection GIF -->
                            <div class="injection-gif">
                                <img src="{{ url_for('static', filename='injection.gif') }}" alt="Injection">
                            </div>
                        </div>

                        <!-- other buttons (if any) stay as they are -->
                    </div>

                </form>
            </div>

            <!-- CSV Upload Tab -->
            <div id="csv" class="tab-content">
                <form action="/predict_csv" method="POST" enctype="multipart/form-data" class="upload-form">
                    <div class="form-section">
                        <div class="section-header">
                            <span class="section-icon"></span>
                            <h3>CSV Processing</h3>
                        </div>
                        <p class="section-description">
                            Upload a CSV file with pre-calculated patient features for bulk analysis.
                        </p>

                        <div class="upload-area">
                            <div class="upload-icon">üìÅ</div>
                            <p class="upload-text">Drag & drop your CSV file here or click to browse</p>
                            <input type="file" name="file" accept=".csv" required id="file-input">
                            <button type="button" class="browse-btn" onclick="document.getElementById('file-input').click()">
                                Choose File
                            </button>
                            <p class="upload-hint">Supported format: .csv (Max 10MB)</p>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="btn-icon">üì§</span>
                                <span>Upload & Process</span>
                            </button>
                            <a href="/help" class="secondary-btn">
                                <span class="btn-icon">üì•</span>
                                <span>Download Template</span>
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p class="footer-warning">‚ö†Ô∏è Research Prototype - Not for Clinical Diagnosis</p>
            <p class="footer-copy">&copy; 2025 ToxiDose AI Project</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>